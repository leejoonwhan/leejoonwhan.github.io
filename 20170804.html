
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<title>GeoLocation</title>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://apis.skplanetx.com/tmap/js?version=1&format=javascript&appKey=2f83cbaa-ad78-33bb-bc92-7bf84786617a"></script>
<script type="text/javascript">

	var map;
	var watchID;
	
	// T-map 초기화
	function initTmap(lon3857, lat3857) {
		
		map = new Tmap.Map({
			div : "map",
			width : "100%",
			height : "500px",
			minZoom: 16, 
			maxZoom: 16,
			animation : true
		});		
		
		cLonLat = new Tmap.LonLat(lon3857, lat3857);
		map.setCenter(cLonLat, 16);
		map.removeZoomControl();						// Zoom Control 제거
		
		var privateMarker = "https://developers.skplanetx.com/upload/tmap/marker/pin_b_m_a.png";
		var engMarker = "https://developers.skplanetx.com/upload/tmap/marker/pin_b_m_a.png"; // 엔지니어
		createMarker(lon3857, lat3857, privateMarker);
		createMarker(lon3857, lat3857, engMarker);
	}
 
	function createMarker(lon3857, lat3857, imgUrl) {
		// Marker Layer의 생성
		var markerLayer = new Tmap.Layer.Markers();
		map.addLayer(markerLayer);
		
		// LonLat객체의 생성
		var lonlat = new Tmap.LonLat(lon3857, lat3857);
		
		//  Icon객체의 생성
		var size = new Tmap.Size(24,38);
		var offset = new Tmap.Pixel(-(size.w/2), -size.h);
		var icon = new Tmap.Icon(imgUrl, size, offset); 
		// var icon = new Tmap.IconHtml("<img src='" + imgUrl + "'></img>", size, offset); 

		var marker = new Tmap.Marker(lonlat, icon); 
		markerLayer.addMarker(marker);
	}
	
	
	// 3857 주소 방식 변환
	function get3857LonLat(coordX, coordY){
		var pr_3857 = new Tmap.Projection("EPSG:3857");
		var pr_4326 = new Tmap.Projection("EPSG:4326");
	    return new Tmap.LonLat(coordX, coordY).transform(pr_4326, pr_3857);
	}
	
	// 4326 주소 방식 변환
	function get4326LonLat(coordX, coordY){
		var pr_3857 = new Tmap.Projection("EPSG:3857");
		var pr_4326 = new Tmap.Projection("EPSG:4326");
	    return new Tmap.LonLat(coordX, coordY).transform(pr_3857, pr_4326);
	}

	// GeoLocation 좌표 구하기
	function geoFindMe() {

		var location = document.getElementById("location");

		if (!navigator.geolocation) {
			location.innerHTML = "<p>사용자의 브라우저는 지오로케이션을 지원하지 않습니다.</p>";
			return;
		}

		function success(position) {
			
			var lat4326 = position.coords.latitude;
			var lon4326 = position.coords.longitude;
			
			var lat3857 = get3857LonLat(lon4326, lat4326).lat;
			var lon3857 = get3857LonLat(lon4326, lat4326).lon;
			
			location.innerHTML = '<p>경도 : ' + lon4326 + '°, 위도 : ' + lat4326 + '°<br>' 
								+'경도 : ' + lon3857 + '°, 위도 : ' + lat3857 + '</p>';
								
			$("#map").empty();					
			initTmap(lon3857, lat3857);
		};

		function error() {
			location.innerHTML = "사용자의 위치를 찾을 수 없습니다.";
		};

		location.innerHTML = "<p>Locating…</p>";

		//navigator.geolocation.getCurrentPosition(success, error);
		navigator.geolocation.watchPosition(success, error);
	}
			
	// 위치 자동 불러오기
	window.onload = function() {
		geoFindMe();
	};
	
	
	
</script>
</head>
<body>

	<p>
		<button onclick="reLoding()">현 위치</button>
	</p>
	<div id="location"></div>

	<div id="map"></div>

</body>
</html>