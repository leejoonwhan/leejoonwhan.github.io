<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script
	src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script
	src="https://apis.skplanetx.com/tmap/js?version=1&format=javascript&appKey=2f83cbaa-ad78-33bb-bc92-7bf84786617a"></script>
<script type="text/javascript">
	var map;
	
	function init() {
		map = new Tmap.Map({
			div : 'map_div',
			width : "100%",
			height : "500px",
			animation : true
		});

		geoFindMe();
	}

	function geoFindMe() {
		var output = document.getElementById("out");

		if (!navigator.geolocation) {
			output.innerHTML = "<p>사용자의 브라우저는 지오로케이션을 지원하지 않습니다.</p>";
			return;
		}

		function success(position) {
			var latitude = position.coords.latitude;
			var longitude = position.coords.longitude;
			var coord = get3857LonLat(longitude, latitude)
			var coordLon = coord.lon;
			var coordLat = coord.lat;

			output.innerHTML = '<p>위도 : ' + latitude + '° <br>경도 : ' + longitude + '°</p>' 
							+ '<p>위도 : ' + coordLon + '° <br>경도 : '	+ coordLat + '°</p>';
			
			createMarker(coordLon, coordLat)
			map.setCenter(new Tmap.LonLat(coordLon, coordLat), 16);
			
		};

		function error() {
			output.innerHTML = "사용자의 위치를 찾을 수 없습니다.";
		};

		output.innerHTML = "<p>Locating…</p>";

		navigator.geolocation.getCurrentPosition(success, error);
	}
	
	function createMarker(coordLon, coordLat) {
		var markerLayer = new Tmap.Layer.Markers();
		map.addLayer(markerLayer);
		 
		var lonlat = new Tmap.LonLat(coordLon, coordLat);
		 
		var size = new Tmap.Size(24,38);
		var offset = new Tmap.Pixel(-(size.w/2), -(size.h/2));
		var icon = new Tmap.Icon('https://developers.skplanetx.com/upload/tmap/marker/pin_b_m_a.png', size, offset); 
		     
		var marker = new Tmap.Marker(lonlat, icon);
		markerLayer.addMarker(marker);
	}
	
	function get3857LonLat(coordX, coordY){
		
		var pr_3857 = new Tmap.Projection("EPSG:3857");
		var pr_4326 = new Tmap.Projection("EPSG:4326");
		
	    return new Tmap.LonLat(coordX, coordY).transform(pr_4326, pr_3857);
	}
</script>
</head>
<body onload="init()">

	<p>
		<button onclick="geoFindMe()">새로고침</button>
	</p>
	
	<div id="out"></div>

	<div id="map_div"></div>

</body>
</html>
